"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("framify.js",["ui.router","framify-paginate","ngStorage","chart.js","ngAria","ngMaterial","ngMessages","jsonFormatter"]).factory("authIntercept",["$localStorage",function(e){return{request:function(n){return e.framify_user?1!=e.framify_user.nullify?(e.framify_user.me&&(n.headers.AuthData=JSON.stringify(e.framify_user.me)),e.framify_user.key&&(n.headers.App_Key=e.framify_user.key),n.headers.Authorization=e.framify_user.token,n):(n.headers.Authorization=e.framify_user.token,n):n}}}]).service("app",["$http","remoteAuth","$q","pdfGen","$localStorage",function(e,n,a,t,r){var o=this;o.pdfGen=t,o.add=function(e,n){return isNaN(parseInt(e)+parseInt(n))?"...":parseInt(e)+parseInt(n)};var i=window.location.href.split("/").filter(function(e){return""!=e&&"http:"!=e&&"https:"!=e}),u=window.location.href.split("/").filter(function(e){return""!=e});o.scheme=u[0],o.ip=i[0].split(":")[0],o.port=i[0].split(":")[1],o.hlink=o.scheme+"//"+o.ip+(void 0!=o.port?":"+o.port:""),o.url=o.hlink;var s=o.hlink;o.nav=[],o.logger=function(e){console.dir(e)},o.redirect=function(e){return e?window.location=e:window.location="/",a.resolve(!0)["catch"](function(e){console.log("Encountered an error when processing the redirect function."),console.dir(e)})},o.setVar=function(e,n,a){return e=e?e:{},e[n]=isNaN(a)?a:parseInt(a),e},o.setVarify=function(e,n,t){return a.resolve(o.setVar(e,n,t))},o.set=function(e,n,a){return e[n]=a},o.getVal=function(e,n){return e[n]},o.getValify=function(e,n){return a.resolve(o.getval(e,n))},o.str=function(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))?JSON.stringify(e):e},o.stringify=function(e){return a.resolve(o.str(e))},o.json=function(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))?e:JSON.parse(e)},o.jsonify=function(e){return a.resolve(o.json(e))},o.md5=function(e){return/^[a-f0-9]{32}$/gm.test(e)?e:CryptoJS.MD5(e).toString()},o.md5ify=function(e){return a.resolve(o.md5(e))},o.base64_encode=function(e){return CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse(e))},o.base64_encodify=function(e){return a.resolve(o.base64_encode(e))},o.base64_decode=function(e){return CryptoJS.enc.Base64.parse(e).toString(CryptoJS.enc.Utf8)},o.base64_decodify=function(e){return a.resolve(o.base64_decode(e))},o.upload=function(n,t){return a(function(a,o){var i=new FormData;for(var u in n)i.append(u,n[u]);e.post(s+"/upload/"+t,i,{transformRequest:angular.identity,headers:{"Content-Type":void 0,Authorization:r.framify_user.token}}).then(function(e){return a(e)})})},o.custom_upload=function(n,t){return a(function(a,o){var i=new FormData;for(var u in n)i.append(u,n[u]);e.post(s+"/"+t,i,{transformRequest:angular.identity,headers:{"Content-Type":void 0,Authorization:r.framify_user.token}}).then(function(e){return a(e)})})},o.keys=function(e){return Object.keys(e)},o.vals=function(e){return Object.keys(e).reduce(function(e,n,a){return e[a]=n,e},[])},o.valsify=function(e){return a.resolve(o.vals(e))},o.clone=function(e){if(null==e||"object"!=("undefined"==typeof e?"undefined":_typeof(e)))return e;var n=e.constructor();for(var a in e)e.hasOwnProperty(a)&&(n[a]=/^[0-9]+$/.test(e[a])?parseInt(e[a]):e[a]);return n},o.clonify=function(e){return a.resolve(o.clone(e))},o.parseInt=function(e){return parseInt(e)},o.parseIntify=function(e){return a.resolve(o.parseInt(e))},o.parseFloat=function(e){return parseFloat(e)},o.parseFloatify=function(e){return a.resolve(o.parseFloat(e))},o.doNothing=function(){return a.resolve()},o.getNumbers=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/\d+/g;return n?e.toString().match(a)[0]:e.toString().match(a)},o.getNumbersify=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/\d+/g;return a.resolve(o.getNumbers((n=!0,t=/\d+/g)))},o.notify=function(e,n,t,r){return UIkit.notify({message:"<center>"+(e||"A blank notification was triggered.")+"</center>",status:n||"info",timeout:t||4e3,pos:"top-center"}),a.resolve(!0)["catch"](function(e){console.dir(e.message)})};o.notify;o.countries=[{name:"Afghanistan",value:"1"},{name:"Albania",value:"2"},{name:"Algeria",value:"3"},{name:"American Samoa",value:"4"},{name:"Andorra",value:"5"},{name:"Angola",value:"6"},{name:"Anguilla",value:"7"},{name:"Antarctica",value:"8"},{name:"Antigua and Barbuda",value:"9"},{name:"Argentina",value:"10"},{name:"Armenia",value:"11"},{name:"Aruba",value:"12"},{name:"Australia",value:"13"},{name:"Austria",value:"14"},{name:"Azerbaijan",value:"15"},{name:"Bahamas",value:"16"},{name:"Bahrain",value:"17"},{name:"Bangladesh",value:"18"},{name:"Barbados",value:"19"},{name:"Belarus",value:"20"},{name:"Belgium",value:"21"},{name:"Belize",value:"22"},{name:"Benin",value:"23"},{name:"Bermuda",value:"24"},{name:"Bhutan",value:"25"},{name:"Bolivia",value:"26"},{name:"Bosnia and Herzegowina",value:"27"},{name:"Botswana",value:"28"},{name:"Bouvet Island",value:"29"},{name:"Brazil",value:"30"},{name:"British Indian Ocean Territory",value:"31"},{name:"Brunei Darussalam",value:"32"},{name:"Bulgaria",value:"33"},{name:"Burkina Faso",value:"34"},{name:"Burundi",value:"35"},{name:"Cambodia",value:"36"},{name:"Cameroon",value:"37"},{name:"Canada",value:"38"},{name:"Cape Verde",value:"39"},{name:"Cayman Islands",value:"40"},{name:"Central African Republic",value:"41"},{name:"Chad",value:"42"},{name:"Chile",value:"43"},{name:"China",value:"44"},{name:"Christmas Island",value:"45"},{name:"Cocos (Keeling) Islands",value:"46"},{name:"Colombia",value:"47"},{name:"Comoros",value:"48"},{name:"Congo",value:"49"},{name:"Congo, the Democratic Republic of the",value:"50"},{name:"Cook Islands",value:"51"},{name:"Costa Rica",value:"52"},{name:"Cote d'Ivoire",value:"53"},{name:"Croatia (Hrvatska)",value:"54"},{name:"Cuba",value:"55"},{name:"Cyprus",value:"56"},{name:"Czech Republic",value:"57"},{name:"Denmark",value:"58"},{name:"Djibouti",value:"59"},{name:"Dominica",value:"60"},{name:"Dominican Republic",value:"61"},{name:"East Timor",value:"62"},{name:"Ecuador",value:"63"},{name:"Egypt",value:"64"},{name:"El Salvador",value:"65"},{name:"Equatorial Guinea",value:"66"},{name:"Eritrea",value:"67"},{name:"Estonia",value:"68"},{name:"Ethiopia",value:"69"},{name:"Falkland Islands (Malvinas)",value:"70"},{name:"Faroe Islands",value:"71"},{name:"Fiji",value:"72"},{name:"Finland",value:"73"},{name:"France",value:"74"},{name:"France Metropolitan",value:"75"},{name:"French Guiana",value:"76"},{name:"French Polynesia",value:"77"},{name:"French Southern Territories",value:"78"},{name:"Gabon",value:"79"},{name:"Gambia",value:"80"},{name:"Georgia",value:"81"},{name:"Germany",value:"82"},{name:"Ghana",value:"83"},{name:"Gibraltar",value:"84"},{name:"Greece",value:"85"},{name:"Greenland",value:"86"},{name:"Grenada",value:"87"},{name:"Guadeloupe",value:"88"},{name:"Guam",value:"89"},{name:"Guatemala",value:"90"},{name:"Guinea",value:"91"},{name:"Guinea-Bissau",value:"92"},{name:"Guyana",value:"93"},{name:"Haiti",value:"94"},{name:"Heard and Mc Donald Islands",value:"95"},{name:"Holy See (Vatican City State)",value:"96"},{name:"Honduras",value:"97"},{name:"Hong Kong",value:"98"},{name:"Hungary",value:"99"},{name:"Iceland",value:"100"},{name:"India",value:"101"},{name:"Indonesia",value:"102"},{name:"Iran (Islamic Republic of)",value:"103"},{name:"Iraq",value:"104"},{name:"Ireland",value:"105"},{name:"Israel",value:"106"},{name:"Italy",value:"107"},{name:"Jamaica",value:"108"},{name:"Japan",value:"109"},{name:"Jordan",value:"110"},{name:"Kazakhstan",value:"111"},{name:"Kenya",value:"112"},{name:"Kiribati",value:"113"},{name:"Korea, Democratic People's Republic of",value:"114"},{name:"Korea, Republic of",value:"115"},{name:"Kuwait",value:"116"},{name:"Kyrgyzstan",value:"117"},{name:"Lao, People's Democratic Republic",value:"118"},{name:"Latvia",value:"119"},{name:"Lebanon",value:"120"},{name:"Lesotho",value:"121"},{name:"Liberia",value:"122"},{name:"Libyan Arab Jamahiriya",value:"123"},{name:"Liechtenstein",value:"124"},{name:"Lithuania",value:"125"},{name:"Luxembourg",value:"126"},{name:"Macau",value:"127"},{name:"Macedonia, The Former Yugoslav Republic of",value:"128"},{name:"Madagascar",value:"129"},{name:"Malawi",value:"130"},{name:"Malaysia",value:"131"},{name:"Maldives",value:"132"},{name:"Mali",value:"133"},{name:"Malta",value:"134"},{name:"Marshall Islands",value:"135"},{name:"Martinique",value:"136"},{name:"Mauritania",value:"137"},{name:"Mauritius",value:"138"},{name:"Mayotte",value:"139"},{name:"Mexico",value:"140"},{name:"Micronesia, Federated States of",value:"141"},{name:"Moldova, Republic of",value:"142"},{name:"Monaco",value:"143"},{name:"Mongolia",value:"144"},{name:"Montserrat",value:"145"},{name:"Morocco",value:"146"},{name:"Mozambique",value:"147"},{name:"Myanmar",value:"148"},{name:"Namibia",value:"149"},{name:"Nauru",value:"150"},{name:"Nepal",value:"151"},{name:"Netherlands",value:"152"},{name:"Netherlands Antilles",value:"153"},{name:"New Caledonia",value:"154"},{name:"New Zealand",value:"155"},{name:"Nicaragua",value:"156"},{name:"Niger",value:"157"},{name:"Nigeria",value:"158"},{name:"Niue",value:"159"},{name:"Norfolk Island",value:"160"},{name:"Northern Mariana Islands",value:"161"},{name:"Norway",value:"162"},{name:"Oman",value:"163"},{name:"Pakistan",value:"164"},{name:"Palau",value:"165"},{name:"Panama",value:"166"},{name:"Papua New Guinea",value:"167"},{name:"Paraguay",value:"168"},{name:"Peru",value:"169"},{name:"Philippines",value:"170"},{name:"Pitcairn",value:"171"},{name:"Poland",value:"172"},{name:"Portugal",value:"173"},{name:"Puerto Rico",value:"174"},{name:"Qatar",value:"175"},{name:"Reunion",value:"176"},{name:"Romania",value:"177"},{name:"Russian Federation",value:"178"},{name:"Rwanda",value:"179"},{name:"Saint Kitts and Nevis",value:"180"},{name:"Saint Lucia",value:"181"},{name:"Saint Vincent and the Grenadines",value:"182"},{name:"Samoa",value:"183"},{name:"San Marino",value:"184"},{name:"Sao Tome and Principe",value:"185"},{name:"Saudi Arabia",value:"186"},{name:"Senegal",value:"187"},{name:"Seychelles",value:"188"},{name:"Sierra Leone",value:"189"},{name:"Singapore",value:"190"},{name:"Slovakia (Slovak Republic)",value:"191"},{name:"Slovenia",value:"192"},{name:"Solomon Islands",value:"193"},{name:"Somalia",value:"194"},{name:"South Africa",value:"195"},{name:"South Georgia and the South Sandwich Islands",value:"196"},{name:"South Sudan",value:"197"},{name:"Spain",value:"198"},{name:"Sri Lanka",value:"199"},{name:"St. Helena",value:"200"},{name:"St. Pierre and Miquelon",value:"201"},{name:"Sudan",value:"202"},{name:"Suriname",value:"203"},{name:"Svalbard and Jan Mayen Islands",value:"204"},{name:"Swaziland",value:"205"},{name:"Sweden",value:"206"},{name:"Switzerland",value:"207"},{name:"Syrian Arab Republic",value:"208"},{name:"Taiwan, Province of China",value:"209"},{name:"Tajikistan",value:"210"},{name:"Tanzania, United Republic of",value:"211"},{name:"Thailand",value:"212"},{name:"Togo",value:"213"},{name:"Tokelau",value:"214"},{name:"Tonga",value:"215"},{name:"Trinidad and Tobago",value:"216"},{name:"Tunisia",value:"217"},{name:"Turkey",value:"218"},{name:"Turkmenistan",value:"219"},{name:"Turks and Caicos Islands",value:"220"},{name:"Tuvalu",value:"221"},{name:"Uganda",value:"222"},{name:"Ukraine",value:"223"},{name:"United Arab Emirates",value:"224"},{name:"United Kingdom",value:"225"},{name:"United States",value:"226"},{name:"United States Minor Outlying Islands",value:"227"},{name:"Uruguay",value:"228"},{name:"Uzbekistan",value:"229"},{name:"Vanuatu",value:"230"},{name:"Venezuela",value:"231"},{name:"Vietnam",value:"232"},{name:"Virgin Islands (British)",value:"233"},{name:"Virgin Islands (U.S.)",value:"234"},{name:"Wallis and Futuna Islands",value:"235"},{name:"Western Sahara",value:"236"},{name:"Yemen",value:"237"},{name:"Yugoslavia",value:"238"},{name:"Zambia",value:"239"},{name:"Zimbabwe",value:"240"}],o.makeResponse=o.make_response=function(e,n,a){return{response:e,data:{message:n,command:a}}},o.date=function(){return new Date},o.toDate=o.to_date=function(e){return new Date(e)},o.newDate=o.new_date=function(){return(new Date).toDateString()},o.isoDate=o.iso_date=function(){return(new Date).format("isoDate")},o.getIsoDate=o.get_iso_date=function(e){return new Date(e).format("isoDate")},o.toIsoDate=o.to_iso_date=function(e){return e.format("isoDate")},o.getIsoString=o.get_iso_string=function(e){return new Date(e).toISOString()},o.dateTime=o.date_time=function(){return(new Date).format("dateTime")},o.getDateTime=o.get_date_time=function(e){return new Date(e).format("dateTime")},o.toDateTime=o.to_date_time=function(e){return e.format("dateTime")},o.monthNum=o.month_num=function(){return(new Date).format("monthNum")},o.getMonthNum=o.get_month_num=function(e){return new Date(e).format("monthNum")},o.toMonthNum=o.to_month_num=function(e){return e.format("monthNum")};var l=o.month_array=["January","February","March","April","May","June","July","August","September","October","November","December"];return o.month_o_array=[{id:0,name:"January"},{id:1,name:"February"},{id:2,name:"March"},{id:3,name:"April"},{id:4,name:"May"},{id:5,name:"June"},{id:6,name:"July"},{id:7,name:"August"},{id:8,name:"September"},{id:9,name:"October"},{id:10,name:"November"},{id:11,name:"December"}],o.printMonths=function(){return $month_o_array.reduce(function(e,n){e[n]=n},{}).filter(function(e){return e})},o.ajax=function(e,n,a){return $.ajax({method:e||"POST",url:n,data:a,dataType:"jsonp",headers:{"Access-Control-Allow-Origin":"*"}})},o.getJSON=o.get_json=function(e){return $.getJSON(e.replace(/callback=?/gi,"")+"?callback=?")},o.cgi=function(e,n,a){return $.ajax({method:e||"GET",url:n||o.hlink,data:a,dataType:"jsonp",headers:{"Access-Control-Allow-Origin":"*"}})},o.loadify=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6e3,n=arguments[1];return a(function(a,t){var r=UIkit.modal.blockUI('<center><i style="color:blue;" class="fa fa fa-spinner fa-pulse fa-5x fa-fw"></i></center>'+(n?"<center><br>"+n+"</center>":""));e&&!isNaN(e)?setTimeout(function(){r.hide(),a(!0)},e):a(r)})},o.alert=function(e,n,t){return UIkit.modal.alert('<font color="#1976D2" style="font-weight:bold;text-transform:uppercase;">'+(e||"Notice")+"</font>\n            <hr>\n            <center>"+(n||"</center><font color=red font-weight=bold; font-size=2em>Oops!</font><br>Something nasty happened!<center>")+"</center>"),t&&"function"==typeof t?a.resolve(t(n))["catch"](function(e){console.log("Encountered an error when processing the alert function."),console.dir(e)}):a.resolve(!0)["catch"](function(e){console.log("Encountered an error when processing the alert2 function."),console.dir(e)})},o.confirm=function(e,n,t){return a(function(a){UIkit.modal.confirm('<font color="#1976D2" style="font-weight:bold;text-transform:uppercase;">'+(e||"Confirmation required.")+"</font>\n                <hr>\n                <center>"+n+"</center>",function(){a(t&&"function"==typeof t?t(n):!0)})})},o.prompt=function(e,n,t,r){return a(function(a){UIkit.modal.prompt('<font color="#1976D2" style="font-weight:bold;text-transform:uppercase;">'+(e||"Info required")+"</font>\n            <hr>\n            "+(n||"email")+" :",t||"",function(e){a(r&&"function"==typeof r?r(e):e)})})},o.isemail=/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/,o.isEmail=o.is_email=function(e){return o.isemail.test(e)},o.isusername=/^[a-z0-9_-]{4,16}$/,o.isUsername=o.is_username=function(e){return o.isusername.test(e)},o.ispassword=/^[-@.\/\!\$\%\^|#&,+\w\s]{6,50}$/,o.isPassword=o.is_password=function(e){return o.ispassword.test(e)},o.isnumber=/^-{0,1}\d*\.{0,1}\d+$/,o.isNumber=o.is_number=function(e){return o.isnumber.test(e)},o.istelephone=/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im,o.ismultitelephone=/^([\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}(?:,|$))+$/im,o.isTelephone=o.is_telephone=function(e){return o.istelephone.test(e)},o.isMultiTelephone=o.is_multi_telephone=function(e){return o.ismultitelephone.test(e)},o.isimei=/^[0-9]{15}$/,o.isImei=o.is_imei=function(e){return o.isimei.test(e)},o.isdateTime=/^(0[1-9]|[12][0-9]|3[01])-(0[1-9]|1[012])-(19|20)[0-9]{2} (2[0-3]|[0-1][0-9]):[0-5][0-9]$/,o.isDateTime=o.is_date_time=function(e){return o.isdateTime.test(e)},o.matches=function(e,n){return e===n},o.num2month=function(e){return!isNaN(e)&&e<=11?l[e]:"Invalid Month Number"},o.unique=o.removeDuplicates=o.remove_duplicates=function(e){return Array.isArray(e)?e.filter(function(e,n,a){return a.indexOf(e)==n}):["The  applied method only processes Arrays"]},o.count=function(e,n){return Array.isArray(n)?Array.isArray(e)?e.reduce(function(e,a,t){return e[a]=n.filter(function(e){return e==a}).length,e},{}):n.filter(function(n){return n==e}).length:o.notify("Failed to count occurances on a non array object.","danger")},o.post=function(n,t){return a(function(a,r){e.post(n,t).success(a).error(r)})},o.get=function(n,t){return a(function(a,r){e.get(n,{params:t}).success(a).error(r)})},o.put=function(n,t){return a(function(a,r){e.put(n,t).success(a).error(r)})},o["delete"]=function(n,t){return a(function(a,r){e["delete"](n,{params:t}).success(a).error(r)})},o.db=function(n,t){return a(function(a,r){t=t?t:s+"/sms/",e.get(t,{params:n}).success(a).error(r)})},o.mail=function(t,r){return a(function(a,o){r=r?r:n.url+"/mail",e.post(r,t).success(a).error(o)})},o.welcomeMail=function(n,t){return a(function(a,r){t=t?t:"/welcome",e.post(t,n).success(a).error(r)})},o.handler=function(e){e=e.response?e:e.data,200==e.response?o.alert("<font color=green>Done</font>",o.str(e.data.message)):o.alert("<font color=red>Uh Oh!</font> ( "+e.response+" Error )",o.str(e.data.message))},o.errorHandler=o.error_handler=o.e_handler=function(e){e=e.response?e:e.data,o.alert("<font color=red>Uh Oh!</font>",o.str(e.data.message))},o.remote_handler=o.remoteHandler=function(e){o.alert("<font color=blue>Data Response</font>",o.str(o.str(e)))},o.countSMS=o.count_sms=function(e){return 0==Math.ceil(e.length/160)?1:Math.ceil(e.length/160)},o.countSMSify=o.count_smsify=function(e){return a.resolve(o.countSMS(e))},o.tabulate=function(e,n,t){return UIkit.modal.alert('<font color="#1976D2" style="font-weight:bold;text-transform:uppercase;"> DOWNLOAD NOTICE</font> <hr> <center>The report is being generated.<center>'),a(function(a,r){var o=new jsPDF("l","pt");o.autoTable(n,t,{styles:{fillColor:[100,175,250],fontSize:5},columnStyles:{id:{fillColor:255}},margin:{top:60},addPageContent:function(n){o.text(e+" at "+(new Date).format("yyyy/mm/dd HH:mm"),40,30)}}),a(o.save(e+" "+(new Date).format("yyyy/mm/dd HH:mm")+".pdf"))})},o}]).service("remoteAuth",["$http","$localStorage","$q",function(e,n,a){var t=this;return t.url="http://bixbyte.io",t.setUrl=t.set_url=function(e){return a(function(n,a){t.url=e,n(e)})},t.SetAuth=t.set_auth=function(t){return a(function(a,r){a(e.defaults.headers.common.Authorization=t||n.framify_user?n.framify_user.token:void 0)})},t.Register=t.register=function(n){return a(function(a,r){e.post(t.url+"/auth/register",n).success(function(e){200==e.response?a(n):r(e.data.message)}).error(function(e){r(JSON.stringify((e&&e.data?e.data.message:e)||"Could not obtain a response from the server."))})})},t.Login=t.login=function(r){return a(function(a,o){console.log(t.url),e.get(t.url+"/auth/verify",{params:r}).success(function(e){200==e.response?(n.framify_user=e.data.message,a(e.data.message)):o(e.data.message)}).error(function(e){console.dir(e),o(JSON.stringify((e&&e.data?e.data.message:e)||"Could not obtain a response from the server."))})})},t.Logout=t.logout=function(){return a(function(e,a){delete n.framify_user,document.cookie.split(";").forEach(function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")}),e()})},t}]).service("auth",["remoteAuth",function(e){return Object.assign(this,e),this}]).service("iSMS",["$http","$q","app",function(e,n,a){var t=window.location.href.split("/").filter(function(e){return""!=e&&"http:"!=e&&"https:"!=e}),r=window.location.href.split("/").filter(function(e){return""!=e}),o=this;return o.provider=r[0]+"//"+t[0].split(":")[0]+(void 0!=t[0].split(":")[1]?":"+t[0].split(":")[1]:"")+"/sms",o.setProvider=o.set_provider=function(e){o.provider=e.toString().includes("/sms")?e:e+"/sms",console.log("All SMS requests via the i service will now be routed to "+o.provider)},o.one=function(t){return n(function(n,r){e.post(o.provider+"/one",t).success(function(e){200==e.response?n(e):r(e)}).error(function(e){r(a.make_response(500,JSON.stringify((e&&e.data?e.data.ismsssage:e)||"Could not obtain a response from the server.")))})})},o.many=function(t){return n(function(n,r){e.post(o.provider+"/many",t).success(function(e){200==e.response?n(e):r(e)}).error(function(e){r(a.make_response(500,JSON.stringify((e&&e.data?e.data.ismsssage:e)||"Could not obtain a response from the server.")))})})},o.template=function(t){return n(function(n,r){e.post(o.provider+"/template",t).success(function(e){200==e.response?n(e):r(e)}).error(function(e){r(a.make_response(500,JSON.stringify((e&&e.data?e.data.ismsssage:e)||"Could not obtain a response from the server.")))})})},o.test=function(t){return n(function(n,r){e.post(""+o.provider,t).success(function(e){200==e.response?n(e):r(e)}).error(function(e){r(a.make_response(500,JSON.stringify((e&&e.data?e.data.ismsssage:e)||"Could not obtain a response from the server.")))})})},o.echo=function(t){return n(function(n,r){e.post(o.provider+"/echo",t).success(function(e){200==e.response?(a.alert("<font color=green>SMS ECHO</font>",a.str(e.data.message)),n(e)):r(e)}).error(function(e){r(a.make_response(500,JSON.stringify((e&&e.data?e.data.message:e)||"Could not obtain a response from the server.")))})})},o.handler=function(e){return n(function(n,t){var r=e.response?a.clone(e):a.clone(e.data);200==e.response?(a.alert("<font color=green>SMS RESPONSE</font>",a.str(e.data.message)),n(r)):(a.alert("<font color=red>SMS Sending</font> ( "+e.response+" Error )",a.str(e.data.message)),t(r))})},o}]).run(["app","$rootScope","$state","$localStorage","auth","remoteAuth","$http","iSMS",function(e,n,a,t,r,o,i,u){n.location=a,n.storage=t,n.app=e,n.frame={},n.iSMS=u,n.auth=r,n.remoteAuth=o,n.frame.path=function(){return a.absUrl().split("/#/")[0]+"/#/"+a.absUrl().split("/#/")[1].split("#")[0]},n.frame.relocate=function(e){return n.location.go(e)},n.permissions={admin_only:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!e.role&&"admin"==e.role},admin_only_org:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];return!!e.role&&("admin"==e.role&&e.organization==n)},client_only:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!e.role&&"client"==e.role},client_only_org:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];return!!e.role&&("client"==e.role&&e.organization==n)},audit_only:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!e.role&&"audit"==e.role},audit_only_org:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];return!!e.role&&("audit"==e.role&&e.organization==n)},admin_client:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!!e.role&&("admin"==e.role||"client"==e.role)},admin_client_org:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];return!!e.role&&(("admin"==e.role||"client"==e.role)&&e.organization==n)},any_admin_client_org:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];return!!e.role&&("audit"!=e.role&&("admin"==e.role||e.organization==n))},any:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!0},any_org:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];return e.organization==n},any_admin_other_org:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];return"admin"==e.role||e.organization==n}},n.getRoles=function(){if(t.framify_user){var e=t.framify_user.me.roles?t.framify_user.me.roles.split(",").map(function(e){return e.replace(/^\s/gi,"").replace(/\s$/gi,"")}):[];return e.push(t.framify_user.me.organization_name),e}n.auth.Logout()}}]).controller("framifyController",["$scope","$state","$rootScope","$http","$q",function(e,n,a,t,r){e.current={},e.ui={},a.nav=[],a.nav.search,e.nav.hasFilters=!1,e.openFilters=function(n){e.nav.hasFilters=n===!0},a.app.reinit=function(){return e.location.path("/")},e.objectInArray=e.object_in_array=e.obj_in_array=function(e,n){for(var a=e.length,t=0;t<a;t++){for(var r=Object.keys(e[t]),o=!0,i=0;i<r.length;i++){var u=e[t][r[i]];n[r[i]]!==u&&(o=!1)}if(1==o)return t}return-1},a.exec=function(e){return e()},a.setVar=a.set_var=function(e,n,t){if(1===n.length)e[n[0]]=t;else{var r=n.shift();e[r]=a.setVar("undefined"==typeof e[r]?{}:e[r],n,t)}return e},e.arrayPush=e.array_push=function(e,n){return Array.isArray(e)?Array.isArray(n)?e.concat(n):function(){var a=JSON.parse(JSON.stringify(e));return a.push(n),a}():[]},e.add={},e.fetch={},e.fetched={},e.counted={},e.data={},e.actions={prequeue:[]},e.data.login={},e.data.admin={},e.addAction=e.add_action=function(n,a){return e.actions[n]=a},e.logedin=!1,e.appRedirect=e.app_redirect=function(e){return n.go("app."+e)},e.goTo=e.go_to=function(e){return n.go(e)},e.unwanted=["$$hashKey","$index","$$state"],e.removeUnwanted=e.remove_unwanted=function(n){return Object.keys(n).forEach(function(a){e.unwanted.indexOf(a)!=-1&&(n[a]=void 0,delete n[a])}),n},e.removeUnwantedify=e.remove_unwantedify=function(n){return r.resolve(e.removeUnwanted(n))},e.encryptFields=e.encrypt_fields=function(n,a){return n.split(",").reduce(function(n,a){return n[a]&&(n[a]=e.app.md5(n[a])),n},a)},e.encryptFieldsify=e.encrypt_fieldsify=function(n,a){return r.resolve(e.encrypt_fields(n,a))},e.generic_db_request_handler=function(n,a,t,o){return r(function(r,i){var u=e.app.json(t);if(200==u.response)"string"==typeof u.data.message&&e.app.notify("<center> "+u.data.message+"</center>","success"),"custom"==n?e.cFetched[a.toString()]=u.data.message:"count"==n?e.counted[a.toString()]=u.data.message:"fetch"!=n?e.fetch(a,{specifics:o.specifics}):e.fetched[a.toString()]=u.data.message,e.data[a.toString().replace(/vw_/gi,"")]={},r(u.data.message);else{if(Array.isArray(u.data.message)){var s=u.data.message[2].match(/DETAIL:(.*)/);void 0!=s||null!=s?u.data.message=s[1]:u.data.message=u.data.message[2],r(u.data.message)}e.app.notify("<center>"+u.data.message+"</center>","danger"),i(e.app.makeResponse(500,v[1]))}})},e.add=function(n,a,t,o){return r(function(r,i){a=a?e.app.json(a):{},a.command="add",a.table=void 0!=n?n.toString().replace(/vw_/gi,""):"",a.extras=a&&a.extras?a.extras.replace(/LIMIT 1/gi,""):void 0,t&&(a=e.encrypt_fields(t,a)),e.app.db(e.removeUnwanted(a)).then(function(t){e.generic_db_request_handler("add",n,t,a).then(function(e){o?o(e):r(e)})["catch"](i)})})},e.update=function(n,a,t,o){return r(function(r,i){a=a?e.app.json(a):{},a.command="update",a.table=void 0!=n?n.toString().replace(/vw_/gi,""):"",a.extras=a&&a.extras?a.extras.replace(/LIMIT 1/gi,""):void 0,t&&(a=e.encrypt_fields(t,a)),e.app.db(e.removeUnwanted(a)).then(function(t){e.generic_db_request_handler("update",n,t,a).then(function(e){o?o(e):r(e)})["catch"](i)})})};var o=function(n,a,t){return r(function(r,o){a=a?e.app.json(a):{},a.command="get",a.table=n,t&&(a=e.encrypt_fields(t,a)),e.app.db(e.removeUnwanted(a)).then(function(t){e.generic_db_request_handler("fetch",n,t,a).then(function(e){r(e)})["catch"](o)})})};e.fetch=function(e,n,a,t){if(Array.isArray(e)){var i=e.filter(function(e){return"undefined"!=typeof e[0]}).reduce(function(e,n,t){return e[t]=o(n[0],n[1]||[],a),e},[]).filter(function(e){return"undefined"!=typeof e});return r.all(i)}return r.resolve(o(e,n,a))["catch"](function(e){})},e.del=function(n,a,t,o){return r(function(r,i){a=a?e.app.json(a):{},a.command="del",a.table=void 0!=n?n.toString().replace(/vw_/gi,""):"",t&&(a=e.encrypt_fields(t,a)),e.app.db(e.removeUnwanted(a)).then(function(t){e.generic_db_request_handler("del",n,t,a).then(function(e){o?o(e):i(e)})["catch"](r)})})},e.redirect=function(e){return e?window.location=e:window.location="/#/framify",r.resolve(!0)["catch"](function(e){console.log("Encountered an error when processing the redirect function."),console.dir(e)})},e.custom=function(n,a,t,o){return r(function(r,i){a=a?e.app.json(a):{},a.command="custom",t&&(a=e.encrypt_fields(t,a)),e.app.db(e.removeUnwanted(a)).then(function(t){e.generic_db_request_handler("add",n,t,a).then(function(e){o?o(e):r(e)})["catch"](i)})})},e.count=function(n,a,t,o){return r(function(r,i){a=a?e.app.json(a):{},a.table=n,a.command="count",a.token=a.token||{},t&&(a=e.encrypt_fields(t,a)),e.app.db(e.removeUnwanted(a)).then(function(t){e.generic_db_request_handler("add",n,t,a).then(function(e){o?o(e):r(e)})["catch"](i)})})},e.sort=function(n){e.sortKey=n,e.reverse=!e.reverse},e.sanitize=function(e,n){if(n)return n.split(",").forEach(function(n){delete e[n]}),r.resolve(e)["catch"](function(e){console.log("Encountered an error when processing the sanitize function."),console.dir(e)})},e.dPush=e.d_push=function(e,n,a){return e[n]=a,e},e.dPushify=e.d_pushify=function(n,a,t){return r.resolve(e.dPush(n,a,t))},e.currmoin=e.app.monthNum(),e.setMoin=e.set_moin=function(n){e.currmoin=n},e.delParams=e.del_params=function(n,a){var t=n?e.app.clone(n):{};return a=a?Array.isArray(a)?a:a.split(","):[],a.forEach(function(e){t[e]=null,delete t[e]}),t},e.addExtras=function(e,n,a,t){return r(function(r,o){e=e||{},n=n||{},a=a||"",t=t||"";var i="",u=[],s=[];t=t.split(",").filter(function(e){return e}),t.forEach(function(e){n[e]=null,delete n[e]}),a.split(",").forEach(function(e,n){var a=e.split(":");u[n]=a[0],s[n]=a[1]});var l=Object.keys(n);u.forEach(function(e,a){l.indexOf(e)!=-1&&(n[s[a]]=n[e],n[e]=null,delete n[e])}),u=Object.keys(n),s=null,u.forEach(function(e,a){var t=isNaN(n[e])?"'"+n[e]+"'":parseInt(n[e]);i+=" "+e+"="+t+" AND"}),u=null,e.extras=i.replace(/AND+$/,""),r(e)})},e.add_extras=function(e,n,a,t){return r(function(r,o){e=e||{},n=n||{},a=a||["",""],t=t||["",""];var i="",u=[],s=[],l=[],c=[];if(Array.isArray(a)&&Array.isArray(t)){var d=t[0].split(",").filter(function(e){return e}),f=t[1].split(",").filter(function(e){return e});d.forEach(function(n){e[n]=null,delete e[n]}),f.forEach(function(e){n[e]=null,delete n[e]});var m=a[0].split(","),p=a[1].split(",");m.forEach(function(e,n){var a=e.split(":");u[n]=a[0],l[n]=a[1]}),p.forEach(function(e,n){var a=e.split(":");s[n]=a[0],c[n]=a[1]});var v=Object.keys(n),h=Object.keys(e);u.forEach(function(n,a){h.indexOf(n)!=-1&&(e[l[a]]=e[n],e[n]=null,delete e[n])}),s.forEach(function(e,a){v.indexOf(e)!=-1&&(n[c[a]]=n[e],n[e]=null,delete n[e])}),s=null,s=Object.keys(n),c=null,s.forEach(function(e,a){var t=isNaN(n[e])?"'"+n[e]+"'":parseInt(n[e]);i+=" "+e+"="+t+" AND"}),s=null,e.extras=i.replace(/AND+$/,""),r(e)}else o("This Method only allows substitution and removal Arrays, <br> please consider using the <b><i>addExtras</i></b> object instead.")})},e.service={},e.entity={},e.showService=function(n){e.service.available=!0,e.service.current=n},e.showEntity=function(n){e.entity.available=!0,e.entity.current=n},e.howMany=function(n,a){var a=a||{
owner:e.storage.user.username};a=a?e.app.json(a):{},a.table=n||"entities",a.command="count",a.token={},e.app.db(e.removeUnwanted(a)).then(function(t){e.generic_db_request_handler("count",n,t,a).then(function(e){resolve(e)})["catch"](reject)})},e.data.login=e.data.login||{},e.data.me=e.data.me||{},e.setData,e.handlers={},e.r_handlers=e.handlers,e.handlers.regSuccess=e.r_handlers.regSuccess=e.handlers.reg_success=e.r_handlers.reg_success=function(a){e.app.notify("The user has been registered"),n.go("app.login")},e.handlers.loginSuccess=e.r_handlers.loginSuccess=e.handlers.login_success=e.r_handlers.login_success=function(a){e.app.notify("<i class='fa fa-2x fa-spin fa-circle-o-notch'></i> Processing your login data","success",4e3),n.go("app.index")},e.handlers.regError=e.r_handlers.regError=e.handlers.reg_error=e.r_handlers.reg_error=function(n){e.app.alert("<font color='red'>Signup Error</font>",n)},e.handlers.loginError=e.r_handlers.loginError=e.handlers.login_error=e.r_handlers.login_error=function(n){e.app.alert("<font color='red'>Login Error</font>",n)},e.handlers.identity=e.r_handlers.identity=function(){return r(function(a,r){t({method:"GET",url:e.app.hlink.replace(/auth/gi,"")+"/auth/me",headers:{Authorization:e.storage.framify_user.token}}).success(function(n){r(e.data.me=n.data.message)}).error(function(t){console.dir(t),e.auth.Logout().then(function(){e.data.me=void 0,e.app.notify("<i class='fa  fa-exclamation-triangle'></i>&nbsp;&nbsp;Your lease has expired <br>Please Login to continue.","danger"),a(n.go("app.login"))})})})},e.handlers.isLogedIn=e.handlers.is_loged_in=function(){return r(function(a,r){e.storage.framify_user?t.defaults.headers.common.Authorization&&void 0!=t.defaults.headers.common.Authorization&&""!=t.defaults.headers.common.Authorization?"app.login"==n.current.name?a(n.go("app.index")):a():e.auth.SetAuth(void 0).then(function(){"app.login"==n.current.name?a(n.go("app.index")):a()}):(e.data.me=void 0,"app.login"!=n.current.name&&(e.app.notify("<i class='fa  fa-exclamation-triangle'></i>&nbsp;&nbsp;Please Login to continue.","danger"),r(n.go("app.login"))))})},e.r_handlers.isLogedIn=e.r_handlers.is_loged_in=function(){return r(function(a,r){e.storage.framify_user?t.defaults.headers.common.Authorization&&void 0!=t.defaults.headers.common.Authorization&&""!=t.defaults.headers.common.Authorization?"app.login"==n.current.name?a(n.go("app.index")):a():e.remoteAuth.SetAuth(void 0).then(function(){"app.login"==n.current.name?a(n.go("app.index")):a()}):(e.data.me=void 0,"app.login"!=n.current.name&&(e.app.notify("<i class='fa  fa-exclamation-triangle'></i>&nbsp;&nbsp;Please Login to continue.","danger"),r(n.go("app.login"))))})},e.data.recovery={},e.data.queued=[],e.recover_password=function(n){e.data.recovery.response="Loading ...",t({method:"POST",url:e.remoteAuth.url+"/passwords/forgot",data:{email:n}}).then(function(n){e.data.recovery.response=n.data.data.message,e.app.alert("Password Recovery",n.data.data.message),e.data.recovery.email=""})},e.isSignedUp=function(n){return r(function(a,t){e.app.welcomeMail({from:"Jambopay SMS Dashboard <smsdashboard@jambopay.com>",to:n.email,subject:"Welcome to our platform",data:{name:n["name.first"],telephone:n.telephone,username:n["account.name"]}},e.remoteAuth.url+"/welcome").then(function(t){e.app.alert("User Added","<center style='font-size:1.4em;'>The user <font color='green'>"+n["name.first"]+"</font>.<br><br> has successfully been registered.</center>"),a(!0)})["catch"](function(t){e.app.alert("User Added","<center style='font-size:1.4em;'>The user <font color='green'>"+n["name.first"]+"</font>.<br><br> has successfully been registered.</center>"),a(!0)})})},e.SmsSuccess=function(n){delete e.storage.framify_user.nullify,e.app.alert("SMS REQUEUE RESPONSE","Message(s) successfuly requeued!")},e.SmsError=function(n){delete e.storage.framify_user.nullify,e.app.alert('<font color="red">SMS REQUEUE RESPONSE</font>',e.app.str(n.data||n))},e.requeue=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(function(a,r){e.storage.framify_user.nullify=!0,e.app.notify("Requeueing the SMS message","warning"),t({url:"http://sms.jambopay.co.ke/SMSService/Api/SMS",method:"POST",data:$.param({SenderName:n.Sender_Name||"",Mobile:n.Phone||"",Message:n.Message||""}),headers:{DeveloperKey:"084049D0-AB72-4EE2-9EDE-0C25C1D1268C",Password:"1d95a4c6d681ede5b18c89b21ceb46bfea7b8e4d8f824107615a2ee297493710","Content-Type":"application/x-www-form-urlencoded"}}).success(a).error(r)})},e.prequeue=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return r(function(a,t){if(n)if(e.actions.prequeue){var r=e.obj_in_array(e.actions.prequeue,n);r!=-1?(e.actions.prequeue.splice(r,1),a()):(e.actions.prequeue.push(n),a())}else t();else t()})},e.processQueue=function(){return r(function(n,a){var t=e.actions.prequeue.reduce(function(n,a,t){return n[t]=e.requeue(a),n},[]).filter(function(e){return e});r.all(t).then(function(a){delete e.storage.framify_user.nullify,e.actions.prequeue=[],n(a)})["catch"](function(n){delete e.storage.framify_user.nullify,e.actions.prequeue=[],a(n)})})},e.topup_handler=function(n){n=e.app.json(n),200==n.response?(e.data.topup={},e.fetch("vw_organization_balances"),e.app.alert("TOPUP RESPONSE",n.data.message)):(e.data.topup={},e.app.alert("<font color=red>TOPUP RESPONSE</font>",n.data.message||"There was no response from the topup server."))},e.removify_roles=function(e,n){if(n)return e.reduce(function(e,a,t){return e+"<button  ng-click=\" (permissions.admin_only_org(data.me,1)) ? ( [del('permissions',{member_id: "+n+", shortcode: '"+a.replace(/\s/gi,"")+"' }),fetch_user_assignments("+n+')] ) : app.doNothing() " class="md-btn uk-width-1-5" style="margin-bottom:1em;">'+a+' <i class="uk-icon uk-icon-times uk-text-muted col-red pull-right" ng-show="permissions.admin_only_org(data.me,1)" ></i></button>'},"")},e.assignify_roles=function(n,a){if(a){if(n=n.reduce(function(e,n,a){return e[a]=n.org.replace(/\s/gi,""),e},[]),e.fetched.vw_user_permissions){var t=e.fetched.vw_user_permissions[0]?e.fetched.vw_user_permissions[0].roles.split(",").filter(function(e){return e}).map(function(e){return e.replace(/ /gi,"")}):[e.fetched.vw_members[0].organization_name],r=n.filter(function(e){return t.indexOf(e)==-1}).reduce(function(e,n,t){return e+"<button ng-click=\"add('permissions',{ member_id: "+a+", shortcode: '"+n+"' });fetch_user_assignments("+a+');" class="md-btn uk-width-1-5" style="margin-bottom:1em !important;">'+n+' <i class="fa fa-plus uk-text-muted col-green pull-right" ng-if="permissions.admin_only_org(data.me,1)"></i></button>'},"");return""!=r?r:'<div class="uk-alert uk-text-center">THERE ARE NO MORE SHORTCODES TO ASSIGN TO THIS USER</div>'}return n.reduce(function(e,n,t){return e+"<button ng-click=\"add('permissions',{ member_id: "+a+", shortcode: '"+n+"' });fetch_user_assignments("+a+');" class="md-btn uk-width-1-5" style="margin-bottom:1em !important;">'+n+' <i class="uk-icon uk-icon-plus uk-text-muted col-green" ng-if="permissions.admin_only_org(data.me,1)"></i></button> &nbsp;'},"")}},e.fetch_user_assignments=function(n){setTimeout(function(){e.fetch("vw_user_permissions",{member_id:n})},300)},e.data.pass_recovery={},e.data.current_user={},e.modaler=function(e){console.log("Performing changes for "+e);var n=UIkit.modal(e);console.dir(n.isActive()),n.isActive()?n.hide():n.show()},e.contact_placeholders=["{{contact_first_name}}","{{contact_middle_name}}","{{contact_last_name}}","{{contact_phone_number}}","{{contact_owner}}","{{contact_identification}}","{{contact_gender}}","{{contact_county}}","{{contact_address}}","{{contact_birthday}}"],e.appendText=function(e,n){return(n?n:"")+" "+e},e.current_contact={},e.setContact=function(n){e.current_contact=e.app.clone(n)},e.fromXML=function(e){return e=e?e.includes("<?xml version")?e.match(/<faultstring>(.*?)<\/faultstring>/gi)[0].replace(/<.?faultstring>/gi,""):e:""},e.myTags=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments[1];return n?e.filter(function(e){return e.contact_id==n}):[]},e.unusedTags=function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return r(function(n){e.fetched.tags=e.fetched.tags?e.fetched.tags:[],e.fetched.vw_contact_grouping=e.fetched.vw_contact_grouping?e.fetched.vw_contact_grouping:[];var a=e.fetched.vw_contact_grouping.reduce(function(e,n,a){return e.push(n.tag_id),e},[])||[];e.fetched.applicable_tags=e.fetched.tags.filter(function(e){return a.indexOf(e.tag_id)==-1}),n()})},e.update_joined_groups=function(){e.fetch([["vw_contact_grouping",{contact_id:e.current_contact.contact_id}],["tags"]]).then(function(){e.unusedTags()})["catch"](function(){e.unusedTags()})},e.update_grouping_data=function(n){e.data.current_tag=n?n:e.data.current_tag;e.fetch([["vw_contacts_with_tags",{contact_tag:e.data.current_tag}]]).then(function(){e.contacts_fetched=!0})["catch"](function(){e.contacts_fetched=!0})},e.login_status=function(){return!!e.storage.framify_user},e.password_recover=function(n,a){e.app.post(e.app.hlink+"/"+n,a).then(e.app.handler)["catch"](e.app.handler)},e.get_sms_balance=function(){e.fetch("vw_organization_balances")}}]).directive("contenteditable",[function(){return{restrict:"A",require:"ngModel",link:function(e,n,a,t){function r(){t.$setViewValue(n.html())}t.$render=function(){n.html(t.$viewValue||0)},n.bind("blur keyup change",function(){e.$apply(r)})}}}]).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(n,a,t){var r=e(t.fileModel),o=r.assign;a.bind("change",function(){n.$apply(function(){t.multiple?o(n,a[0].files):o(n,a[0].files[0])})})}}}]).config(["ChartJsProvider","$httpProvider",function(e,n){n.interceptors.push("authIntercept"),e.setOptions({colors:["#1976D2","#292955","#7CB342","#FB8C39","#d81b60","#2196f3","#cddc39","#00897b","#5d4037","#212121","#9c27b0"]})}]).controller("chartcontroller",["$scope","$q","app","worker",function(e,n,a,t){e.charts={type:"line"},e.fetched=e.fetched||{},e.showCharts=!1,e.show_charts=function(){return e.showCharts},e.labels2=["total_delivered","total_pending","total_failed","total_requeued"],e.labels=[],e.app=a,e.getData=function(n,a){if(Array.isArray(n)&&n[0]){var t=n.filter(function(e){return e.sender&&"null"!=e.sender&&null!=e.sender}),r={data:[],labels:[],series:["Delivered","Pending","Failed","Requeued"],total:[],requeue:[],total_series:["Received"],options:{colors:["#FF0000","#00FF00","#0000FF","#aaaaaa","#00CCFF","#FFCCFF","#000000"],title:{display:!0,text:a.replace(/\_/gi," ").toUpperCase()},legend:{display:!0,position:"bottom"}}};e.charts[""+a]=t.reduce(function(e,n,a){return e.chart.labels.push(n.sender+" ("+n.total_received+")"),e.data.delivered.push(n.total_delivered),e.data.pending.push(n.total_pending),e.data.failed.push(n.total_failed),e.data.requeued.push(n.total_requeued),e.chart.requeue.push([n.total_requeue_failed,n.total_requeue_sent]),e.chart.total.push(n.total_received),a==t.length-1?(e.chart.data=Array(e.data.delivered,e.data.pending,e.data.failed,e.data.requeued),e.chart):e},{chart:e.app.clone(r),data:{delivered:[],pending:[],failed:[],requeued:[]}})}else e.app.alert("<font color=red>CHART DRAW ERROR</font>","<center>Failed to draw the required charts<br><br>Please ensure that you are loged in then continue.</center>")},e.promisify=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return n(function(t,r){if(Array.isArray(a)){var o=a.reduce(function(n,a,t){return n[t]=e.app.db({command:"get",table:a[0]||a}),n},[]);n.all(o).then(function(n){Object.assign(e.fetched,n.reduce(function(e,n,t){return e[a[t][0]]=n.data?n.data.message:n||[],e},{})),t()})["catch"](function(n){e.app.logger(n)}).then(t)}else e.app.alert("Promisify Error","Failed to capture the indices required for this request to terminate."),r()})},e.draw_charts=function(){e.fetched=={}?e.app.alert("<font color='red'>Chart Drawing Failure</font>","Please fetch the required data before initiating a chart draw!"):(e.showCharts=!0,e.getWeekData([e.fetched.vw_sms_one_day,e.fetched.vw_sms_two_day,e.fetched.vw_sms_three_day,e.fetched.vw_sms_four_day,e.fetched.vw_sms_five_day,e.fetched.vw_sms_six_day,e.fetched.vw_sms_seven_day],"seven_day_summary"))},e.getWeekData=function(a,t,r){return n(function(n,o){if(Array.isArray(a)&&a[0]){var i=a.filter(function(e){return e.length>0});if(i.length>0){e.charts[""+t]={data:[],labels:r||e.getDays(),series:e.getSeries(i),total:[],requeue:[],total_series:[],options:{colors:["#1976D2","#292955","#7CB342","#FB8C39","rgba(99,0,0,.9)","#2196f3","#cddc39","#00897b","#5d4037","#212121","#9c27b0"],title:{display:!0,text:t.replace(/\_/gi," ").toUpperCase()},legend:{display:!0,position:"bottom"}}};var u=e.charts[""+t].series.reduce(function(e,n,a){return e.delivered[n]=[],e.failed[n]=[],e.pending[n]=[],e.requeued[n]=[],e.requeue[n]=[],e.total[n]=[],e},{delivered:{},failed:{},pending:{},requeued:{},requeue:{},total:{}});a.forEach(function(n){n=n.filter(function(e){return e.sender}),u=0!=n.length&&Array.isArray(n)?e.getSeries(i).reduce(function(a,t,r){var o=!1;return n.reduce(function(e,a,r){return 0==r&&(e.delivered[t]=e.delivered[t]||[],e.pending[t]=e.pending[t]||[],e.failed[t]=e.failed[t]||[],e.requeued[t]=e.requeued[t]||[],e.requeue[t]=e.requeue[t]||[],e.total[t]=e.total[t]||[]),a.sender==t&&(o=!0,e.delivered[t].push(parseInt(a.total_delivered)||0),e.pending[t].push(parseInt(a.total_pending)||0),e.failed[t].push(parseInt(a.total_failed)||0),e.requeued[t].push(parseInt(a.total_requeued)||0),e.requeue[t].push([parseInt(a.total_requeue_failed)||0,parseInt(a.total_requeue_sent)||0]),e.total[t].push(parseInt(a.total_received)||0)),r==n.length-1&&0==o&&(e.delivered[t].push(0),e.pending[t].push(0),e.failed[t].push(0),e.requeued[t].push(0),e.requeue[t].push([0,0]),e.total[t].push(0)),e},e.app.clone(a))},e.app.clone(u)):Object.keys(u.delivered).reduce(function(e,n,a){return e.delivered[n]=e.delivered[n]||[],e.delivered[n].push(0),e.pending[n]=e.pending[n]||[],e.pending[n].push(0),e.failed[n]=e.failed[n]||[],e.failed[n].push(0),e.requeued[n]=e.requeued[n]||[],e.requeued[n].push(0),e.requeue[n]=e.requeue[n]||[],e.requeue[n].push([0,0]),e.total[n]=e.total[n]||[],e.total[n].push(0),e},e.app.clone(u))}),n(e.charts[t].data={delivered:Object.keys(u.delivered).map(function(e){return u.delivered[e]||0}),failed:Object.keys(u.failed).map(function(e){return u.failed[e]||0}),pending:Object.keys(u.pending).map(function(e){return u.pending[e]||0}),requeued:Object.keys(u.requeued).map(function(e){return u.requeued[e]||0}),requeue:Object.keys(u.requeue).map(function(e){return u.requeue[e]||0}),total:Object.keys(u.total).map(function(e){return u.total[e]||0})})}else n(e.app.alert("<font color='red'>CHART GENERATOR ERROR</font>","<center>It seems like there are no records to display for this week.</center>"))}else n(e.app.alert("<font color=red>CHART DRAW ERROR</font>","<center>Failed to draw the required charts<br><br>Please ensure that you are loged in then continue.</center>"))})},e.getDays=function(){for(var e=864e5,n=new Date,a=[],t=0;t<=6;t++)a.push(new Date(n-t*e).format("ddd < hh:mm TT"));return a},e.getSeries=function(n){if(Array.isArray(n)){return Array.isArray(n[0])?e.app.unique(n.reduce(function(e,n,t){return e=n.reduce(function(e,n,a){return e.push(n.sender),e},a.clone(e))},[])).filter(function(e){return null!=e&&void 0!=e&&"undefined"!=e&&"null"!=e}):e.app.unique(n.reduce(function(e,n,a){return e[a]=n.sender,e},[]))}return e.app.alert("Chart Drawing Error","The Multichart Series Label Generator expects an array"),[]},e.summaries={delivered:0,failed:0,success_rate:0,cost:0},e.prepare_rates=function(){return n(function(n,a){e.summaries=e.fetched.vw_general_stats.reduce(function(e,n,a){return e.delivered+=parseInt(n.total_delivered)||0,e.failed+=parseInt(n.total_failed)||0,e.success_rate=e.delivered/(e.delivered+e.failed)*100,e},{delivered:0,failed:0,success_rate:0}),n()})}}]).directive("userEdit",function(){return{restrict:"E",templateUrl:"views/permissions.html"}}).directive("compile",["$compile",function(e){return function(n,a,t){n.$watch(function(e){return e.$eval(t.compile)},function(t){a.html(t),e(a.contents())(n)})}}]).service("UuidService",[function(){return{generate:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}}]).service("pdfGen",["$q","$rootScope","UuidService",function(e,n,a){var t=this;return t.WebWorkerService=function(e,n){new Worker("assets/js/worker.js");this.activate()},t}]).service("worker",["$q","$rootScope","UuidService",function(e,n,a){var t=this,r=new Worker("assets/js/worker.js");return t.activate=function(){r.addEventListener("message",t.onWebWorkerResponse,!1)},t.genCharts=function(e){console.log("\nAttempting to generate charts");var n=a.generate();return r.postMessage(JSON.stringify([n,"generateCharts",e])),console.log(n),n},t.onWebWorkerResponse=function(e){console.log("\nThe webworker completed it's computaional task");var a=JSON.parse(e.data),t=a[0],r=a[1];n.$apply(n.$broadcast(t,r))},t.activate(),t}]).directive("a",[function(){return{restrict:"E",link:function(e,n,a){n.on("click",function(e){a.disabled&&e.preventDefault()})}}}]).directive("fileDownload",function(){return{restrict:"E",scope:{fileurl:"@fileurl",linktext:"@linktext"},template:'<a href="{{ fileurl }}" download>{{ linktext }}</a>',link:function(e,n,a){}}});